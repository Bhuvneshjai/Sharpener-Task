<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Send Message</title>
</head>
<body>
    <h1>Welcome, <span id="username"></span>!</h1>

    <form id="messageForm">
        <label for="message">Type your message:</label>
        <input type="text" id="message" name="message" required>
        <button type="submit">Send Message</button>
    </form>

    <div id="messageList"></div>

    <script>
        const username = localStorage.getItem('username');
        document.getElementById('username').textContent = username;

        const messageForm = document.getElementById('messageForm');
        const messageInput = document.getElementById('message');
        const messageList = document.getElementById('messageList');

        // Function to fetch and display messages
        const fetchAndDisplayMessages = () => {
            fetch('/send/all')
                .then(response => response.json())
                .then(messages => {
                    messageList.innerHTML = ''; // Clear previous messages

                    messages.forEach(message => {
                        const messageItem = document.createElement('div');
                        messageItem.textContent = `${message.username}: ${message.message}`;
                        messageList.appendChild(messageItem);
                    });
                })
                .catch(error => console.error('Error fetching messages:', error));
        };

        // Fetch and display messages on page load
        fetchAndDisplayMessages();

        // Handle message form submission
        messageForm.addEventListener('submit', (event) => {
            event.preventDefault();
            const enteredMessage = messageInput.value;

            fetch('/send', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({ message: enteredMessage }),
            })
                .then(response => response.text())
                .then(message => {
                    console.log(message);
                    // Fetch and display messages after sending a new message
                    fetchAndDisplayMessages();
                })
                .catch(error => console.error('Error sending message:', error));
        });
    </script>
</body>
</html>
